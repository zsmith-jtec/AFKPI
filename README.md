# AFKPI - Weekly Manufacturing KPI Dashboard

A FastAPI backend for tracking weekly manufacturing KPIs: Revenue, Gross Margin, and Labor costs.

## Features

- **Revenue Tracking**: Inbound (orders) and Outbound (shipped) revenue by product group
- **Gross Margin Analysis**: Actual vs target margin with drill-down to category/job level
- **Labor & Burden**: Direct labor and burden costs by job
- **Drill-Down**: Product Group → Category → Job navigation
- **JWT Authentication**: Role-based access for stakeholders
- **Audit Logging**: Track all data changes and user actions

## Tech Stack

- **Backend**: Python FastAPI
- **Database**: SQLite (can migrate to PostgreSQL)
- **ORM**: SQLAlchemy 2.0
- **Validation**: Pydantic v2
- **Auth**: JWT (python-jose)

## Quick Start

```bash
# Install dependencies
pip install -r requirements.txt

# Run the server
uvicorn app.main:app --reload

# Open API docs
# http://localhost:8000/docs
```

## API Endpoints

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/api/auth/login` | POST | Login and get JWT token |
| `/api/auth/me` | GET | Get current user info |
| `/api/weeks` | GET | List available weeks |
| `/api/revenue` | GET | Revenue summary by product |
| `/api/revenue/trend` | GET | Revenue trend (13 weeks) |
| `/api/margin` | GET | Gross margin summary |
| `/api/margin/trend` | GET | Margin trend (13 weeks) |
| `/api/labor` | GET | Labor summary by job |
| `/api/drill/product/{group}` | GET | Drill to categories |
| `/api/drill/category/{cat}` | GET | Drill to jobs |
| `/api/drill/job/{job_num}` | GET | Job detail |
| `/api/audit` | GET | Audit log (auth required) |

## Data Model

```
dim_week          - Week dimension (ISO year/week)
dim_product       - Product hierarchy (Line > Group > Category)
dim_job           - Job to Sales Order mapping
fact_revenue      - Weekly revenue by product
fact_costs        - Weekly costs by job (labor, burden, material)
audit_log         - User action tracking
```

## ETL Process

1. Export BAQs from Epicor (CSV/Excel)
2. Place files in `data/sample/`
3. Run ETL scripts to load into database

See `app/etl/` for data transformation logic.

## Target Users

| Role | Access |
|------|--------|
| CFO, Controller | Full margin and revenue data |
| COO, Directors | Operations metrics, labor data |
| Sales Directors | Revenue by product |
| Developers | API access, audit logs |

## Frontend (Replit AI)

The frontend is designed to be generated by Replit AI. See `REPLIT_PROMPT.md` for detailed instructions.

## License

Internal use only - JTEC Industries
